;/*!/widget/web/filter/config.js*/
define("yc_common:widget/web/filter/config",function(e,i,a){var t={index:{type:1,text:"热门排行榜"},piaolist:{type:2,menulist:["cityId","typeId","rank","filter"],clickMenuFixed:!0,daSrc:"bnpiaoPiaolistPg"},stadium:{type:1,text:"近期演出"},calendar:{type:3,menulist:["cityId","typeId","rank"],hidenum:!0,clickMenuFixed:!0,daSrc:"bnpiaoCalendarPg"}},d={cityId:{id:"",name:"全国",ifFixed:"false",maxHeight:1,showNum:!0},typeId:{id:"",name:"全部",ifFixed:"false",showNum:!0},rank:{id:"default",name:"默认排序",ifFixed:"false"},filter:{id:"",name:"筛选",ifFixed:"false"}},n={pageConfig:t,headerData:d};a.exports=n});
;/*!/widget/web/filter/filter.js*/
define("yc_common:widget/web/filter/filter",function(require,exports,module){var bdTemplate=require("yc_common:static/util/bdTemplate"),urlUtil=require("yc_common:static/util/url"),config=require("yc_common:widget/web/filter/config"),headerData=config.headerData,FILTERTMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push('<h1 class="piao-bar-container border border-top '),_template_fun_array.push(1==type?" piao-bar-type1 ":"hide border-bottom piao-bar-type2"),_template_fun_array.push('">'),1==type){if(_template_fun_array.push("    "),text&&_template_fun_array.push('    <span class="fl">',"undefined"==typeof text?"":baidu.template._encodeHTML(text),"</span>    "),_template_fun_array.push("     "),menulist&&menulist.length>0){var length=menulist.length;_template_fun_array.push("         ");for(var i=0;length>i;i++){var menu=menulist[i];_template_fun_array.push('         <span class="filter-menu fr" data-key="',"undefined"==typeof menu?"":baidu.template._encodeHTML(menu),'" data-id="">全国</span>         ')}_template_fun_array.push("     ")}_template_fun_array.push("")}else{_template_fun_array.push("");for(var i=0;i<menulist.length;i++){var menu=menulist[i],menuData=headerData[menu];_template_fun_array.push(""),"cityId"==menu?_template_fun_array.push('<span class="filter-menu " data-key="',"undefined"==typeof menu?"":baidu.template._encodeHTML(menu),'" data-id="',"undefined"==typeof selectCityId?"":baidu.template._encodeHTML(selectCityId),'" data-iffixed="',"undefined"==typeof menuData.ifFixed?"":baidu.template._encodeHTML(menuData.ifFixed),'"  data-maxHeight="',"undefined"==typeof menuData.maxHeight?"":baidu.template._encodeHTML(menuData.maxHeight),'" data-shownum="',"undefined"==typeof(menuData.showNum||"")?"":baidu.template._encodeHTML(menuData.showNum||""),'">',"undefined"==typeof selectCityName?"":baidu.template._encodeHTML(selectCityName),"</span>"):"typeId"!=menu&&_template_fun_array.push('<span class="filter-menu " data-key="',"undefined"==typeof menu?"":baidu.template._encodeHTML(menu),'" data-id="',"undefined"==typeof menuData.id?"":baidu.template._encodeHTML(menuData.id),'" data-iffixed="',"undefined"==typeof(menuData.ifFixed||"")?"":baidu.template._encodeHTML(menuData.ifFixed||""),'" data-shownum="',"undefined"==typeof(menuData.showNum||"")?"":baidu.template._encodeHTML(menuData.showNum||""),'">',"undefined"==typeof menuData.name?"":baidu.template._encodeHTML(menuData.name),"</span>"),_template_fun_array.push("")}_template_fun_array.push("")}_template_fun_array.push('</h1><div class="filter-list-container"></div><div class="type-list-container border border-bottom hide" id="typeWrapper"></div><p class="filter-slide-up"><span></span></p>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],CITYTMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("");var data=data||{};_template_fun_array.push("");var cityList=data.cityList||{},hotCitys=cityList.hotCitys||[],citys=cityList.citys||{};if(_template_fun_array.push('<ul class="filter-list filter-list-city" data-key="cityId">    <li class="loc-city-area">        <p class="title">定位城市</p>        <p class="filter-item loc-city'),(!cityId||0>=cityId||!cityName)&&_template_fun_array.push(" disabled"),_template_fun_array.push('" data-id="',"undefined"==typeof cityId?"":baidu.template._encodeHTML(cityId),'"        data-text=',"undefined"==typeof cityName?"":baidu.template._encodeHTML(cityName),">"),cityId&&cityName&&cityId>0?_template_fun_array.push("","undefined"==typeof cityName?"":baidu.template._encodeHTML(cityName)," "):_template_fun_array.push("定位失败"),_template_fun_array.push("</p>    </li>    "),hotCitys&&hotCitys.length>0){_template_fun_array.push('    <li class="hot-city-area">        <p class="title letter-index-title" data-index-key="hot">热门城市</p>        <ul class="hot-city-list clearfix">        ');for(var lenHot=hotCitys.length,j=0;lenHot>j;j++){var itemHot=hotCitys[j]||{};_template_fun_array.push('            <li class="filter-item" data-id="',"undefined"==typeof(itemHot.cityId||"")?"":baidu.template._encodeHTML(itemHot.cityId||""),'" data-text="',"undefined"==typeof(itemHot.cityName||"")?"":baidu.template._encodeHTML(itemHot.cityName||""),'">',"undefined"==typeof(itemHot.cityName||"")?"":baidu.template._encodeHTML(itemHot.cityName||""),"</li>        ")}_template_fun_array.push("        </ul>    </li>    ")}_template_fun_array.push("    ");for(var letterLength=citys.length,i=0;letterLength>i;i++){var letterItem=citys[i]||{},letter=letterItem.head||"",letterCitylist=letterItem.city||[];_template_fun_array.push('    <li class="letter-index letter-index-title" data-index-key="',"undefined"==typeof letter?"":baidu.template._encodeHTML(letter),'">',"undefined"==typeof letter?"":baidu.template._encodeHTML(letter),"</li>        ");for(var lenCity=letterCitylist.length,m=0;lenCity>m;m++){var itemCity=letterCitylist[m];_template_fun_array.push('        <li class="filter-item touching clearfix" data-id="',"undefined"==typeof itemCity.cityId?"":baidu.template._encodeHTML(itemCity.cityId),'" data-text="',"undefined"==typeof itemCity.cityName?"":baidu.template._encodeHTML(itemCity.cityName),'">',"undefined"==typeof itemCity.cityName?"":baidu.template._encodeHTML(itemCity.cityName),""),-1==itemCity.cityPiaoNum||hidenum||_template_fun_array.push('<i class="num">',"undefined"==typeof(itemCity.cityPiaoNum||0)?"":baidu.template._encodeHTML(itemCity.cityPiaoNum||0),"</i>"),_template_fun_array.push("</li>        ")}_template_fun_array.push("    ")}_template_fun_array.push('</ul><ul id="letterList" class="letter-list" data-key="letterIndex">    '),hotCitys&&hotCitys.length>0&&_template_fun_array.push('    <li data-index="hot">热门</li>    '),_template_fun_array.push("     ");for(var letterLength=citys.length,i=0;letterLength>i;i++){var letterItem=citys[i]||{},letter=letterItem.head||"";_template_fun_array.push('    <li data-index="',"undefined"==typeof(letter||"")?"":baidu.template._encodeHTML(letter||""),'">',"undefined"==typeof(letter||"")?"":baidu.template._encodeHTML(letter||""),"</li>    ")}_template_fun_array.push("</ul>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],TYPETMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("");var data=data||{};_template_fun_array.push("");var typeList=data.typeList||[];_template_fun_array.push('<ul class="filter-list filter-list-items filter-list-type" data-key="typeId">    ');for(var length2=typeList.length,j=0;length2>j;j++){var item2=typeList[j];_template_fun_array.push('    <li class="filter-item clearfix" data-id="',"undefined"==typeof item2.typeId?"":baidu.template._encodeHTML(item2.typeId),'" data-text="',"undefined"==typeof item2.typeName?"":baidu.template._encodeHTML(item2.typeName),'"><img src="',"undefined"==typeof item2.typeLogo?"":baidu.template._encodeHTML(item2.typeLogo),'"    />',"undefined"==typeof item2.typeName?"":baidu.template._encodeHTML(item2.typeName),""),-1==item2.typePiaoNum||hidenum||_template_fun_array.push('<i class="num">',"undefined"==typeof(item2.typePiaoNum||0)?"":baidu.template._encodeHTML(item2.typePiaoNum||0),"</i>"),_template_fun_array.push("</li>    ")}_template_fun_array.push("</ul>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],RANKTMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<ul class="filter-list filter-list-items" data-key="rank">    ');for(var length3=rankList.length,m=0;length3>m;m++){var item3=rankList[m];_template_fun_array.push('    <li class="filter-item" data-id="',"undefined"==typeof item3.rankCode?"":baidu.template._encodeHTML(item3.rankCode),'" data-text="',"undefined"==typeof item3.rankMsg?"":baidu.template._encodeHTML(item3.rankMsg),'">',"undefined"==typeof item3.rankMsg?"":baidu.template._encodeHTML(item3.rankMsg),'<i    class="check"></i></li>    ')}_template_fun_array.push("</ul>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],FILTERLISTTMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<ul class="filter-list filter-list-items" data-key="filter">    ');for(var length4=filter.length,n=0;length4>n;n++){var item4=filter[n];_template_fun_array.push('    <li class="filter-item" data-id="',"undefined"==typeof item4.filterCode?"":baidu.template._encodeHTML(item4.filterCode),'" data-text="',"undefined"==typeof item4.filterMsg?"":baidu.template._encodeHTML(item4.filterMsg),'">',"undefined"==typeof item4.filterMsg?"":baidu.template._encodeHTML(item4.filterMsg),'<i    class="check"></i></li>    ')}_template_fun_array.push("</ul>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],MORTMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<ul class="type-list type-list-items clearfix"">    ');for(var length4=typeList.length,n=0;length4>n;n++){var item4=typeList[n];_template_fun_array.push('    <li class="type-item filter-item border border-all" data-key="typeId" data-id="',"undefined"==typeof item4.typeId?"":baidu.template._encodeHTML(item4.typeId),'" data-text="',"undefined"==typeof item4.typeName?"":baidu.template._encodeHTML(item4.typeName),'">',"undefined"==typeof item4.typeName?"":baidu.template._encodeHTML(item4.typeName),"</li>    ")}_template_fun_array.push("</ul>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],versionNum=window.version,conditionurl="/yanchu/info/condition",listurl="/yanchu/info/piaosearch",filter=function(){this.initPageSize=10;var e={page:1,pageSize:10,from:"native_app"};this.options=e,this.transTime=100,this.clickItemStatus=!1,this.tmplList={cityId:CITYTMPL,typeId:TYPETMPL,rank:RANKTMPL,filter:FILTERLISTTMPL},this.htmlList={}};filter.prototype.init=function(e){function t(t){n._loc=t||{};var a=t.nuomiCityCode,i=t.cityName;n.selectCityId=a,n.selectCityId=a,n.selectCityName=i,n.cityId=a,n.cityName=i,r.cityId=n.selectCityId,r.userCityId=a,n.ele=$(e.domObj),n.ele.addClass("piao-widget-common-filter");var l=config.pageConfig[e.pageindex];n.clickMenuFixed=l.clickMenuFixed,n.type=l.type||2,n.menulist=l.menulist||[],n.text=l.text||"",n.hidenum=l.hidenum,n.daSrc=l.daSrc,n.headerClass=e.headerClass||"",n.params=e.params,n.callback=e.callback||function(){},n.onCityChange=e.onCityChange||function(){},n.initPageSize=e.initPageSize||n.initPageSize,n.pageSize=e.pageSize||r.pageSize,n.params&&($.extend(r,e.params),r.pageSize=n.initPageSize),n.renderHeader(),n.menulist&&n.menulist.length>0&&n.getFilterData(),n.getShowList(),n.bind()}var a,i,n=this,r=n.options,l=e.locParam||{};if(e.domObj){var d;if(PJS.page.getData(function(e){d=n.pageParams=e||{}}),l.cityId||d.cityId){a=l.cityId,i=l.cityName;var s={nuomiCityCode:d.cityId||a,cityName:d.cityIdName||i};t(s)}else PJS.location.getLocation({success:function(e){t(e)},fail:function(){}})}},filter.prototype.renderHeader=function(){var e=this,t=e.selectCityId||e.cityId||headerData.cityId.id,a=e.selectCityName||e.cityName||headerData.cityId.name,i=headerData.typeId;i.id=e.type.id?e.type.id:-1,i.name=e.type.name||"全部",filterhtml=FILTERTMPL({text:e.text,menulist:e.menulist,type:e.type,selectCityId:t,selectCityName:a}),e.ele.html("").prepend(filterhtml),e.ele.css({zIndex:12,position:"relative"}),e.bar=e.ele.find(".piao-bar-container"),e.filterListCon=e.ele.find(".filter-list-container"),e.typeListCon=e.ele.find(".type-list-container"),e.slideUp=e.ele.find(".filter-slide-up"),e.bar.addClass(e.headerClass),e.onCityChange({cityId:t,cityName:a})},filter.prototype.getFilterData=function(){var e=this,t=conditionurl,a={},i=e.menulist.join("|");a.conditionName=i,PJS.http.piaoajax({url:t,data:a,type:"GET",dataType:"json",success:function(t){e.renderFilterList(t)},error:function(){e.renderFilterList()}})},filter.prototype.renderFilterList=function(e){e=e&&e.data?e.data:{};var t=this,a=t.menulist.length,i=t.tmplList,n=t.htmlList;e.cityId=t.cityId,e.cityName=t.cityName||"";var r={rankList:e.rankList||[]},l={filter:e.filter||[]};if(n.rank=i.rank(r),n.filter=i.filter(l),!t.typeScroll){var d={typeList:e.typeList||[]},s=MORTMPL(d);t.typeListCon.html(s),t.typeListCon.removeClass("hide");for(var o,m=t.typeListCon.find("li"),p=m.length,u=0,c=0;p>c;c++)o=m.eq(c),u+=(parseInt(o.width())||0)+10;t.typeListCon.find("ul").width(u);{t.typeScroll=new IScroll("#typeWrapper",{scrollX:!0,scrollY:!1,click:!0,scrollbars:!1,bounceTime:1e3})}}if(1!=t.type&&a){var u=t.ele.width()*(1/(a-1));t.bar.removeClass("hide").find("span").css({width:u})}setTimeout(function(){t.setParams()},50)},filter.prototype.setParams=function(){var e,t,a=this,i=(a.params,a.menulist),n=(a.bar,a.pageParams);for(var r in n)if(!($.inArray(r,i)<0||"typeId"==r)){e=n[r],t=n[r+"Name"],t&&t.length>7&&(t=t.slice(0,6)+"..");var l=$(".filter-menu[data-key="+r+"]");l.length>0&&($(".filter-menu[data-key="+r+"]").attr("data-id",e),"false"===l.attr("data-iffixed")&&l.html(t))}var d,s=n.typeId,o=a.typeListCon.find("li");d=!s||o.filter('[data-id="'+s+'"]').length<1?o.eq(0):o.filter('[data-id="'+s+'"]'),d&&d.addClass("selected").removeClass("border border-all")&&a.typeScroll.scrollToElement(d[0],10,-7)},filter.prototype.getShowList=function(){function e(){t.filterProcessing=!1,PJS.ui.toast.show("网络错误,没有请求到数据~",3),t.callback({filter:t.ele,error:!0})}var t=this,a=t.bar.find(".filter-menu"),i=t.options,n=t.pageParams,r=t.menulist;for(var l in n)if(!($.inArray(l,r)<0)){var d=n[l],s=n[l+"Name"];d&&s&&(i[l]=d)}var o=t.typeListCon.find(".selected.type-item");if(o.length>0){var m=o.attr("data-id"),p=o.attr("data-key");i[p]=m}$.each(a,function(e,t){var a=$(t),n=a.attr("data-key"),r=a.attr("data-id");i[n]=r}),t.clickItemStatus||$.extend(i,t.params),(parseInt(i.cityId)||0)>=0?"":i.cityId=1,(parseInt(i.userCityId)||0)>=0?"":delete i.userCityId,PJS.http.piaoajax({url:listurl,data:i,type:"GET",dataType:"json",success:function(e){e=e||{},e.errorNo||0==e.errorNo||(e.errorNo=-1),t.callback({res:e,filter:t.ele}),t.filterProcessing=!1},error:function(){e()}})},filter.prototype.bind=function(){var e=this;$(".global-mask").on("touchmove",function(e){e.preventDefault()}),e.ele.on("touchmove",function(e){e.preventDefault()}),e.ele.on("click",".filter-menu",function(t){var a=t.currentTarget;e.clickMenu($(a))}),e.ele.on("click",".filter-item",function(t){var a=$(t.currentTarget);e.filterProcessing||(t.stopPropagation(),e.filterProcessing=!0,e.clickItem(a))}),e.ele.on("click",".filter-slide-up",function(t){t.preventDefault();var a=e.targetMenu;e.clickMenu(a)}),e.ele.on("click","#letterList li",function(t){var a=$(t.currentTarget),i=a.attr("data-index"),n=$(".letter-index-title[data-index-key="+i+"]"),r=e.iscroll;r&&n.length>0&&r.scrollToElement(n[0],200)}),$("body").on("touchend",".global-mask",function(t){t.preventDefault();var a=e.targetMenu;e.clickMenu(a)})},filter.prototype.clickMenu=function(e){var t=this;t.targetMenu=e,e.hasClass("selected")?(t.menuUp(e),e.removeClass("selected")):(t.menuDown(e),e.addClass("selected"))},filter.prototype.menuDown=function(e){var t=this,a=e.attr("data-key"),i="",n=t.transTime,r=e.attr("data-shownum"),l=t.filterListCon.find(".filter-list");if(t.clickMenuFixed&&t.setTotalPostion(!0),e.attr("data-key")==t.filterListCon.find(".filter-list").attr("data-key"))return e.addClass("selected").removeClass("icon-arrow-down").addClass("icon-arrow-up"),t.typeListCon.addClass("hide"),t.filterListCon.animate({height:l.height()},n,"ease-out"),setTimeout(function(){t.slideUp.show()},n),void $(".global-mask").show();var d=e.siblings(".filter-menu");if(d.removeClass("selected").addClass("icon-arrow-down").removeClass("icon-arrow-up"),r){var s={},o=e.attr("data-key");s.conditionName=o,s.v=versionNum;for(var m=d.length,p=0;m>p;p++){var u=d.eq(p),a=u.attr("data-key"),c=u.attr("data-id");u.attr("data-shownum")&&(s[a]=c)}var f=t.typeListCon.find(".selected"),_=f.attr("data-id"),y=f.attr("data-key");s[y]=_,PJS.http.piaoajax({url:conditionurl,data:s,type:"GET",dataType:"json",success:function(a){var n=a||{data:{}};n.cityName=t.cityName,n.cityId=t.cityId,n.citySort=t.citySort,n.hidenum=t.hidenum,i=t.tmplList[o](n),t.filterListCon.html(i),t.setSlideDown(e)},error:function(){t.filterListCon.html(i),t.setSlideDown(e)}})}else i=t.htmlList[a],t.filterListCon.html(i),t.setSlideDown(e)},filter.prototype.setSlideDown=function(e){var t=this,a=e.attr("data-key"),i=e.attr("data-id"),n=t.filterListCon.find(".filter-list");"cityId"==a&&t.setLetterStyle(),e.addClass("selected").removeClass("icon-arrow-down").addClass("icon-arrow-up");var r=n.height(),l=parseFloat(e.attr("data-maxHeight"))||0||.67,d=$(window).height()*l-t.bar.height()-20,s=Math.max(r,d);t.realHeight=s,t.filterListCon.css({height:r,maxHeight:d}),t.setPosition(),t.slideUp.show();var o=t.filterListCon.find(".filter-item[data-id='"+i+"']");o?o.addClass("selected"):"",r>d&&(t.iscroll&&t.iscroll.destroy(),setTimeout(function(){t.iscroll=new IScroll(t.filterListCon[0],{scrollbars:!1,bounceTime:1e3,click:!0})},0)),$(".global-mask").show(),t.typeListCon.addClass("hide")},filter.prototype.menuUp=function(e){{var t=this;e.attr("data-key")}t.clickMenuFixed&&t.setTotalPostion(!1),e.removeClass("selected").find("i").removeClass("icon-arrow-up").addClass("icon-arrow-down"),t.filterListCon.animate({height:0},t.transTime,"ease-out"),t.slideUp.hide(),t.typeListCon.removeClass("hide"),$(".global-mask").hide()},filter.prototype.clickItem=function(e){var t=this,a=t.targetMenu,i=t.options,n=t.pageParams;if(!e.hasClass("disabled")){this.clickItemStatus=!0;var r,l,d,s;if(e.hasClass("type-item"))l=e.attr("data-key"),d=e.attr("data-id"),s=e.attr("data-text"),e.addClass("selected").removeClass("border border-all").siblings().removeClass("selected").addClass("border border-all"),r=(t.daSrc?t.daSrc+".":"")+"filterBk.filterLnk_"+d;else{l=a.attr("data-key"),d=e.attr("data-id"),s=e.attr("data-text");var o=e.attr("data-id")||"";if("false"==a.attr("data-iffixed")){var m=e.attr("data-text");m&&m.length>7&&(m=m.slice(0,6)+".."),a.html(m)}if("cityId"==a.attr("data-key")){var p=e.attr("data-id"),u=e.attr("data-text");t.options.cityId=t.selectCityId=p,t.options.cityName=t.selectCityName=u}a.attr("data-id",o),t.menuUp(t.targetMenu),r=(t.daSrc?t.daSrc+".":"")+"filterBk.filterLnk_"+d}if(PJS.stat.addStat({da_src:r,da_act:"click"}),l&&d&&s){n[l]=d,n[l+"Name"]=s;var c=location.origin,f=location.pathname,_=c+f+(c.indexOf("?")>0?"&":"?")+urlUtil.jsonToQuery(n);window.history.replaceState(null,null,_)}e.addClass("filter-processing selected").siblings().removeClass("selected"),i.page=1,t.onCityChange({cityId:p,cityName:u}),t.callback({refresh:!0,filter:t.ele}),t.getShowList()}},filter.prototype.setTotalPostion=function(e){var t=this;e?(t.scrollTopValue=$(window).scrollTop(),t.ele.animate({top:0,position:"absolute"}),$(window).scrollTop(0)):(t.ele.animate({position:"relative"}),$(window).scrollTop(t.scrollTopValue))},filter.prototype.setPosition=function(){var e=this,t=e.bar.height(),a=e.filterListCon.height();e.filterListCon.css({position:"absolute",top:t}),e.slideUp.css({position:"absolute",top:t+a})},filter.prototype.setLetterStyle=function(){var e=this,t=e.letterList=$("#letterList"),a=t.find("li"),i=$(window).height()-e.bar.height()-60,n=a.length;if(n){var r=i/n;a.css({height:r,lineHeight:r+"px"})}},filter.prototype.update=function(e){var t=this,a=t.options;t.options.pageSize=t.pageSize,e.refresh&&(a.page=1,t.clickItemStatus=!0,t.callback({refresh:!0,filter:t.ele})),delete e.refresh,$.extend(t.options,e),t.getShowList()},filter.prototype.toggleSlide=function(e){var t=this,a=t.slideUp,i=t.transTime,n=20;e?(a.show(),a.animate({height:n},i,"ease-out")):(a.animate({height:0},i,"ease-out"),a.hide())},module.exports=new filter});
;/*!/widget/web/backup/backup.js*/
define("yc_common:widget/web/backup/backup",function(require,exports,module){var BACKUP_TMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<a href="javascript:;" class="piao-widget-common-backup backup-btn"><span class="arrow-out"></span><em class="arrow-in"></em></a>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],backup=function(){this.render(),this.setOptions(),this.bind()};backup.prototype.render=function(){var t=this,e=BACKUP_TMPL();$(e).appendTo($("body"));var o=$(".backup-btn");t.ele=o},backup.prototype.setOptions=function(t){var e=this,o=this.winHeight=$("body").height(),a={bottomOffset:15,rightOffset:15,locationOffset:.5*o,scrollTime:100};this.defaultOption=a,$.extend(a,t||{}),this.bottomOffset=a.bottomOffset,this.rightOffset=a.rightOffset,this.locationOffset=a.locationOffset,this.scrollTime=a.scrollTime,e.setPosition(),e.toggleHide()},backup.prototype.setPosition=function(){var t=this,e=t.ele,o=t.bottomOffset,a=(t.winHeight,o),i=t.rightOffset;e.css({bottom:a,right:i})},backup.prototype.toggleHide=function(){var t=this,e=t.ele,o=(t.winHeight,$("body").scrollTop()),a=t.locationOffset;o>=a?1!=e.css("opacity")&&e.animate({opacity:1},500,"ease-out"):0!=e.css("opacity")&&e.animate({opacity:0},500,"ease-out")},backup.prototype.bind=function(){var t=this;$(window).on("scroll",function(){t.toggleHide()}),t.ele.on("click",function(){t.scrollTo(t.scrollTime)})},backup.prototype.scrollTo=function(t){var e=10,o=$("body"),a=o.scrollTop(),i=parseInt(t/e),n=Math.ceil(a/i),s=function(){a=o.scrollTop(),i--,setTimeout(function(){0===a&&0>=i||(a=a-n>0?a-n:0,o.scrollTop(a),s())},e)};s()},module.exports=new backup});
;/*!/widget/web/list/list.js*/
define("yc_common:widget/web/list/list",function(require,exports,module){var bdTemplate=require("yc_common:static/util/bdTemplate"),IScroll=require("yc_common:static/util/iscroll/iscroll-probe"),dateUtil=require("yc_common:static/util/date"),backup=require("yc_common:widget/web/backup/backup"),LOADTMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="piao-widget-container piao-widget-wrapper">    <div class="piao-widget-list">        <ul class="clearfix"></ul>        <div class="loading">        <img src="',baidu.template._encodeHTML("/static/yc_common/img/loading_1b765b6.png"),'" width="97" height="60" />        <p>努力加载中...</p>        </div>    </div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],MORETMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<li class="show-more">上拉加载更多</li>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],WAITTMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<li class="waiting">努力加载中...</li>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],NOMORETMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<li class="piaolist no-more">没有更多演出了</li>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],BACKUPTMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<a href="javascript:;" class="piao-widget-common-backup backup-scroll invisible">        <span class="arrow-out"></span>        <em class="arrow-in"></em></a>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],PIAO_LIST_TMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push("    "),0!=errorNo)return void _template_fun_array.push('    <li class="piaolist piao-error">        <img src=',baidu.template._encodeHTML("/static/yc_common/img/piao_empty_73c47ff.png"),' width="77" height="77" />        <div>',"undefined"==typeof(netWorMsg||emptyMsg||errorMsg||"")?"":netWorMsg||emptyMsg||errorMsg||"","</div>     </li>    ");_template_fun_array.push("    ");var data=data||{},productList=data.productList,totalNum=Math.max(data.productNum||0,productList.length||0),currentTotal=data.currentTotal||0;if(_template_fun_array.push("    "),0==currentListNum&&data.productNum>0&&!data.hasLocal&&"collect"!=piaoType&&_template_fun_array.push('            <li class="piao-city border border-bottom">当前城市暂无演出，我们为您找到了如下推荐</li>    '),_template_fun_array.push("    "),0==errorNo){if(_template_fun_array.push("            "),!productList||productList&&0==productList.length)return _template_fun_array.push("                        "),currentListNum>0?void _template_fun_array.push(""):(_template_fun_array.push('            <li class="piaolist piao-empty">            '),"collect"==piaoType?_template_fun_array.push("<img src=",baidu.template._encodeHTML("/static/yc_common/img/order_empty_447c55f.png"),' width="109" height="102" />            '):_template_fun_array.push("<img src=",baidu.template._encodeHTML("/static/yc_common/img/piao_empty_73c47ff.png"),' width="77" height="77" />            '),void _template_fun_array.push("            <div>","undefined"==typeof(emptyMsg||"抱歉，暂无相关演出")?"":emptyMsg||"抱歉，暂无相关演出","</div>             </li>            "));_template_fun_array.push("            ");for(var i=0;i<productList.length;i++)if(productList[i]){var item=productList[i]||{},showTime=item.showTime||{};_template_fun_array.push('            <li class="piaolist touching" '),daSrc&&(_template_fun_array.push('data-log="{&#39;da_src&#39;:&#39;',"undefined"==typeof daSrc?"":baidu.template._encodeHTML(daSrc),""),showRankNum&&3>i&&_template_fun_array.push("_top","undefined"==typeof(i+1)?"":baidu.template._encodeHTML(i+1),""),_template_fun_array.push('&#39;}"')),_template_fun_array.push(' data-url="piaodetailtpl" bn-data={"productId":',"undefined"==typeof item.productId?"":baidu.template._encodeHTML(item.productId),'} bn-target=1>                        <section class="piao-info">                        <div class="imgbox">                            <img src="',"undefined"==typeof item.productPictureSmallUrl?"":baidu.template._encodeHTML(item.productPictureSmallUrl),'">                            '),showRankNum&&3>i&&_template_fun_array.push('                            <span class="icon-num icon-num',"undefined"==typeof(i+1)?"":baidu.template._encodeHTML(i+1),'">',"undefined"==typeof(i+1)?"":baidu.template._encodeHTML(i+1),"</span>                            "),_template_fun_array.push("                            "),!showLocalTag&&!showRankNum&&3>i&&userCityId==item.cityId&&_template_fun_array.push('                            <span class="icon-local"></span>                            '),_template_fun_array.push('                        </div>                        <div class="content">                            <p class="desc">',"undefined"==typeof subString(item.productName)?"":baidu.template._encodeHTML(subString(item.productName)),'</p>                            <div class="otherdesc">                                <p class="date">',"undefined"==typeof getShowTime(showTime)?"":baidu.template._encodeHTML(getShowTime(showTime)),'</p>                                <p class="addr">',"undefined"==typeof(item.venueName||"")?"":baidu.template._encodeHTML(item.venueName||""),'</p>                                <p class="price">                                    <span class="text fl">                                    ');var lowestPrice=item.lowestPrice,highestPrice=item.highestPrice;(lowestPrice||0===lowestPrice)&&_template_fun_array.push("<em>￥</em>","undefined"==typeof lowestPrice?"":baidu.template._encodeHTML(lowestPrice),""),_template_fun_array.push("                                     "),!lowestPrice&&0!==lowestPrice||!highestPrice&&0!==highestPrice||lowestPrice==highestPrice||_template_fun_array.push("-                                     "),_template_fun_array.push("                                     "),!highestPrice&&0!==highestPrice||lowestPrice==highestPrice||_template_fun_array.push("<em>￥</em>","undefined"==typeof highestPrice?"":baidu.template._encodeHTML(highestPrice),""),_template_fun_array.push("                                     </span>                                    "),item.discount&&10!=item.discount&&_template_fun_array.push('                                        <span class="text-discount">',"undefined"==typeof item.discount?"":baidu.template._encodeHTML(item.discount),"折</span>                                    "),_template_fun_array.push('                                    <span class="fr status status-',"undefined"==typeof item.productStatus?"":baidu.template._encodeHTML(item.productStatus),'">',"undefined"==typeof item.displayStatus?"":baidu.template._encodeHTML(item.displayStatus),'</span>                                </p>                            </div>                           </div>                        </section>                        <section class="slogan border border-bottom">                                        '),item.slogan&&_template_fun_array.push('                                        <span class="arrow"></span>                                        <p>',"undefined"==typeof item.slogan?"":baidu.template._encodeHTML(item.slogan),"</p>                                        "),_template_fun_array.push("                                    </section>            </li>            ")}_template_fun_array.push("             "),_template_fun_array.push(currentTotal>=totalNum?'                            <li class="piaolist no-more">没有更多演出了</li>                        ':'                            <li class="show-more">上拉加载更多</li>                        '),_template_fun_array.push("    ")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],notLoaded=!0,list={init:function(e){var t=this;t.ele=$("#piao-widget-list"),t.option={update:function(){},page:1,pageSize:10,classStr:"",daSrc:""},t.piaoType=e.piaoType||"piao",$.extend(t.option,e),t.option.onclick=e.onclick||function(){},t.pagescroll=e.pagescroll,t.showRankNum=e.showRankNum,t.userCityId="",t.ifEmptyHideBar=e.ifEmptyHideBar,t.ifEmptyHideAll=e.ifEmptyHideAll,t.emptyMsg=e.emptyMsg,t.fixedEle=e.fixedEle,PJS.location.getLocation({success:function(e){t._loc=e||{},t.userCityId=e.nuomiCityCode,t.render()},fail:function(){t.render()}})},render:function(){{var e=this;e.scroll}e.renderStatus||(e.ele.html(LOADTMPL()),e.ele.addClass("piao-widget-common-list loading"),e.container=e.ele.find(".piao-widget-wrapper"),e.setStyle(),e.loading=e.ele.find(".loading"),e.list=e.ele.find(".piao-widget-list ul"),e.pagescroll||(e.ele.append(BACKUPTMPL()),e.backup=$(".backup-scroll")),e.toggleLoading(!0),e.renderStatus=!0)},setStyle:function(){var e=this,t=e.option,a=t.top,i=e.container,r=e.option.classStr;(0==a||t.top)&&i.css("top",a),r?e.ele.addClass(r):""},renderList:function(e){var t=this;e.showRankNum=t.option.page>1?!1:t.showRankNum,e.showLocalTag=t.option.page>1,e.ifEmptyHide=t.ifEmptyHide,e.userCityId=t.userCityId,e.data=e.data||{},e.data.productList=e.data.productList||[],e.data.currentTotal=t.currentTotal,e.currentListNum=t.list.find(".piaolist.touching").length,e.piaoType=t.piaoType||"piao";var a="";e.data.productList.length>0||notLoaded?(notLoaded=!1,a=PIAO_LIST_TMPL(e)):t.list.find(".piao-empty").size()<1&&(a=PIAO_LIST_TMPL(e));var i=t.scroll,r=t.list.find("li").not(".piaolist.touching").not(".piao-city");r.length>0&&r.remove(),t.toggleLoading(!1),t.list.append(a),t.list.find("img").error(function(){$(this).attr("src","/static/yc_common/img/nopic.png").addClass("pic-err")}),t.processing=!1;var o=t.pagescroll,n=t.bindListEventStatus;if(i)setTimeout(function(){i?i.refresh():""},0);else if(o){if(!e||!e.data||!e.data.productList)return;setTimeout(function(){n?"":t.bindListEvent()},200)}else setTimeout(function(){t.scroll=new IScroll(".piao-widget-container",{click:!0,probeType:3}),n?"":t.bindListEvent()},200)},toggleLoading:function(e){var t=this,a=t.ele,i=t.container,r=t.list,o=r.find(".show-more"),n=r.find(".waiting"),l=t.loading;if(1==t.pagescroll&&i.removeClass("piao-widget-container"),e){if(1!=t.option.page)return o.remove(),void t.list.append(WAITTMPL());l.show(),a.addClass("loading")}else{if(1!=t.option.page)return void n.remove();l.hide(),a.removeClass("loading")}},create:function(e){var t=list;t.creatStatus=!0,t.renderStatus||t.render();var e=e||{},a=e.res,i=e.filter,r=e.refresh,o=e.error,n=(t.option.page||1,t.updateStatus?t.currentTotal:0),l=a?a.data||{}:{};if(t.data=l,!a)return o?(t.processing=!1,void t.list.find(".waiting").html("上拉加载更多").removeClass("waiting").addClass("show-more")):void(r&&(t.list.html(""),r&&(t.option.page=1,t.scroll&&t.scroll.scrollTo(0,0)),t.toggleLoading(!0)));a.subString=t.subString,a.getShowTime=t.getShowTime,a.daSrc=t.option.daSrc||"",a.emptyMsg=t.emptyMsg,a.netWorMsg=l.netWorMsg,a.errorMsg=l.errorMsg||"暂无相关演出";var s=t.option.pageSize||(l.productList?l.productList.length||0:0);t.currentTotal=n+s,t._total=l.productNum||0,0==a.errorNo&&a.data&&a.data.productList&&0!=a.data.productList.length?i?i.removeClass("hide"):"":(t.ifEmptyHideBar&&i&&i.addClass("hide"),t.ifEmptyHideAll&&i&&(i.addClass("hide"),t.ele.addClass("hide"))),t.renderList(a),t.updateStatus=!1},bindListEvent:function(){var e=this,t=e.scroll;if(e.bindListEventStatus=!0,t)t.on("scroll",function(){e.toggleBackup(),1==this.directionY&&this.y<=this.maxScrollY+5&&e.showMore()});else{if(!e.data||!e.data.productList)return;var a=e.fixedEle,i=e.ele,r=i.offset().top;$(document).on("scroll",function(){var t=$("body").scrollTop();if(a){var o=a.offset().top;t>o&&(a.css({position:"fixed",top:0}),i.css("paddingTop",a.height())),r-a.height()>t&&(a.css({position:"relative",top:0}),i.css("paddingTop",0))}var n=$("#main").height(),l=$("body").height();5>=n-l-t&&e.showMore()})}e.list.on("click","li",function(t){var a=$(t.currentTarget);e.option.onclick(a)}),e.backup&&e.backup.on("click",function(){e.scrollToTop()})},showMore:function(){var e=this;if(!e.processing){if(e.list.find(".no-more").length>0)return;e.list.find(".show-more").length>0?e.loadMore():e.currentTotal<e._total?e.showLoadMore():e.showNoMore()}},loadMore:function(){var e=this;e.list.find(".show-more").remove(),e.updateStatus=!0,e.loadType=2,e.option.page=++e.option.page;var t=e.option.page;e.toggleLoading(!0),e.processing=!0,e.option.update({page:t})},showLoadMore:function(){var e=this,t=MORETMPL(),a=e.ele.find(".piao-empty");a.length>0&&a.remove(),e.list.append(t),e.scroll?e.scroll.refresh():""},showNoMore:function(){var e=this,t=NOMORETMPL();e.list.append(t),e.scroll?e.scroll.refresh():""},subString:function(e){function t(e){var t=e.match(/[^\x00-\xff]/gi);return e.length+(null==t?0:t.length)}var a=$(window).width(),i=52;if(!e)return"";var r=t(e);if(320>a&&r>42)i=39;else if(a>=370&&r>61)i=60;else{if(!(370>a&&a>=320&&r>48))return e;i=46}var o=/[^\x00-\xff]/g;if(e.replace(o,"mm").length<=i)return e;for(var n=Math.floor(i/2),l=n;l<e.length;l++)if(e.substr(0,l).replace(o,"mm").length>=i)return e.substr(0,l)+"...";return e+"..."},getShowTime:function(e){var t=(e.count||1,e.startTime||""),a=e.endTime||"",i=t?t.replace(/-/g,"/")||"":"",r=new Date(i),o=a?a.replace(/-/g,"/")||"":"",n=new Date(o),l="";if(a){var s=t?dateUtil.format(r,"yyyy.MM.dd"):"",p=a?dateUtil.format(n,"yyyy.MM.dd"):"";l+=s+(t&&a?" 至 ":"")+p}else l+=t?dateUtil.format(r,"yyyy.MM.dd W"):"";return l},toggleBackup:function(){var e=this,t=e.scroll,a=.5*$(window).height(),i=$(".backup-scroll");t&&i&&(parseInt(a)<=Math.abs(e.scroll.y)?i.removeClass("invisible").addClass("visible"):i.removeClass("visible").addClass("invisible"))},scrollToTop:function(){var e=this,t=e.scroll,a=e.backup;t&&a&&(a.hasClass("clicked")||(a.addClass("clicked"),t.scrollTo(0,0,200),setTimeout(function(){a.removeClass("clicked")},200)))}};module.exports=list});